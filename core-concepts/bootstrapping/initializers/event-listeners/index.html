<!DOCTYPE html>
<html>
<head>
    <title></title>
    <link rel="stylesheet" href="/public/assets/pico.min.css">
    <link rel="stylesheet" href="/public/assets/prism.css">
    <link rel="stylesheet" href="/public/assets/style.css">
    <script src="/public/assets/prism.js"></script>
</head>
<body>
<header>
    <nav>
    <a href="https://www.github.com/phpnomad">GitHub</a>
</nav></header>

<div class="docs-layout">
    <aside class="docs-sidebar">
                    <a href="/"><img src="/public/assets/logo.png" alt="PHPNomad Logo"/></a>
            <nav>
    
                                        <details class="nav-section" >
                    <summary>
                                                    Packages
                                            </summary>
                    <div class="nav-group">
                                                            <details class="nav-section" >
                    <summary>
                                                    Utils
                                            </summary>
                    <div class="nav-group">
                                                            <details class="nav-section" >
                    <summary>
                                                    Processors
                                            </summary>
                    <div class="nav-group">
                                                            <div class="nav-item">
                    <a href="/packages/utils/processors/list-sorter" class="">
                        List sorter
                    </a>
                </div>
                                                <div class="nav-item">
                    <a href="/packages/utils/processors/array-processor" class="">
                        Array processor
                    </a>
                </div>
                                                <div class="nav-item">
                    <a href="/packages/utils/processors/list-filter" class="">
                        List filter
                    </a>
                </div>
                        
                    </div>
                </details>
                                                <div class="nav-item">
                    <a href="/packages/utils/array-helper" class="">
                        Array helper
                    </a>
                </div>
                        
                    </div>
                </details>
                        
                    </div>
                </details>
                                                <details class="nav-section" open>
                    <summary>
                                                    Core concepts
                                            </summary>
                    <div class="nav-group">
                                                            <details class="nav-section" open>
                    <summary>
                                                    Bootstrapping
                                            </summary>
                    <div class="nav-group">
                                                            <div class="nav-item">
                    <a href="/core-concepts/bootstrapping/platform-integrations" class="">
                        Platform integrations
                    </a>
                </div>
                                                <details class="nav-section" open>
                    <summary>
                                                    Initializers
                                            </summary>
                    <div class="nav-group">
                                                            <div class="nav-item">
                    <a href="/core-concepts/bootstrapping/initializers/event-listeners" class="">
                        Event listeners
                    </a>
                </div>
                                                <div class="nav-item">
                    <a href="/core-concepts/bootstrapping/initializers/event-binding" class="">
                        Event binding
                    </a>
                </div>
                                                <div class="nav-item">
                    <a href="/core-concepts/bootstrapping/initializers/facades" class="">
                        Facades
                    </a>
                </div>
                        
                    </div>
                </details>
                                                <div class="nav-item">
                    <a href="/core-concepts/bootstrapping/introduction" class="">
                        Introduction
                    </a>
                </div>
                                                <div class="nav-item">
                    <a href="/core-concepts/bootstrapping/advanced-bootstrapping" class="">
                        Advanced bootstrapping
                    </a>
                </div>
                                                <div class="nav-item">
                    <a href="/core-concepts/bootstrapping/creating-and-managing-initializers" class="">
                        Creating and managing initializers
                    </a>
                </div>
                        
                    </div>
                </details>
                        
                    </div>
                </details>
                        
</nav>            </aside>
    <main class="docs-content">
            <h1>Event Listeners in PHPNomad</h1>
<p>Event listeners are like friendly observers in your code that wait for specific things to happen, and then spring into
action when they do. Think of them as helpful assistants who are always ready to respond when something important occurs
in your application.</p>
<p>Events are the bread and butter of PHPNomad, and it leans heavily on using them to keep your system decoupled from the
platform. In-fact, most of the time, you'll find that your entire system will boil down to a series of events that fire,
and then some logic that happens when those actions happen. If you can get very comfortable with thinking about
event-driven approaches, you'll come to love how PHPNomad works.</p>
<h2>The Basics of Event Listeners</h2>
<p>At their core, event listeners are just special classes that &quot;listen&quot; for specific events in your application. When
those events happen, the listeners automatically run their code. Each listener is instantiated through PHPNomad's
container, which means you can easily inject any dependencies you need.</p>
<p>Here's a simple example:</p>
<pre><code class="language-php">use PHPNomad\Email\Interfaces\EmailStrategy;
use PHPNomad\Events\Interfaces\Event;

class UserRegistered implements Event
{
    public function __construct(public readonly string $email, public readonly string $name){}
    
    
    public static function getId(): string
    {
        return 'user_registered';
    }
}

/**
 * @extends CanHandle&lt;UserRegistered&gt;
 */
class WelcomeEmailListener implements CanHandle
{
    public function __construct(private EmailStrategy $emailService) 
    {
        // PHPNomad automatically injects the email service
    }

    public function handle(Event $event): void 
    {
        // Send a welcome email when a new user registers
        $this-&gt;emailService-&gt;send(
            [$event-&gt;email],
            'Welcome to Our Platform!',
            'welcome-email-template',
            ['username' =&gt; $event-&gt;name]
        );
    }
}
</code></pre>
<h2>Setting Up Listeners</h2>
<p>You can set up listeners in your initializer class. This is where you tell PHPNomad &quot;when this happens, run this code&quot;:</p>
<pre><code class="language-php">class MyInitializer implements HasListeners 
{
    public function getListeners(): array
    {
        return [
            // When a user gets registered, send a welcome email.
            UserRegistered::class =&gt; WelcomeEmailListener::class,
            
            // When an order is placed, send the order confirmation and also update the inventory
            OrderPlaced::class =&gt; [
                SendOrderConfirmation::class,
                UpdateInventory::class
            ]
        ];
    }
}
</code></pre>
<p>In this example:</p>
<ul>
<li>When a user registers, the container creates a WelcomeEmailListener (injecting the EmailStrategy) and runs its handle
method</li>
<li>When an order is placed, multiple listeners are created and executed in sequence</li>
</ul>
<p>Now, when you broadcast the <code>UserRegistered</code> event, the <code>WelcomeEmailListener</code> will fire.</p>
<pre><code class="language-php">Event::broadcast(new UserRegistered('alex@fake.email','Alex'));
</code></pre>
<p>Alternatively, you might need to create an event binding that translates a platform event (such as a WordPress hook) to
the <code>UserRegistered</code> event. Check out <a href="event-binding.md">Event Binding</a> for more context on that.</p>
<h2>Why Use Event Listeners?</h2>
<p>Event listeners help keep your code organized and flexible. Instead of putting all your logic in one place, you can
spread it out into focused, manageable pieces. This brings several benefits:</p>
<ol>
<li><strong>Easier to Maintain</strong>: Each listener handles one specific task, making the code simpler to understand and update</li>
<li><strong>More Flexible</strong>: You can add or remove listeners without changing the rest of your code</li>
<li><strong>Better Organization</strong>: Related code stays together, making it easier to find and modify</li>
<li><strong>Dependency Management</strong>: PHPNomad's container handles all dependencies automatically</li>
</ol>
<h2>Real World Example</h2>
<p>Let's look at a practical example. Imagine you're running an online store and someone places an order:</p>
<pre><code class="language-php">use PHPNomad\Email\Interfaces\EmailStrategy;

/**
 * @extends CanHandle&lt;OrderPlaced&gt;
 */
class SendOrderConfirmation implements CanHandle
{
    public function __construct(
        private EmailStrategy $emailService
    ) {}

    public function handle(Event $event): void
    {
        $order = $event-&gt;getOrder();

        $this-&gt;emailService-&gt;send(
            [$order-&gt;getCustomerEmail()],
            'Order Confirmation',
            'order-confirmation-template',
            ['orderNumber' =&gt; $order-&gt;getId()]
        );
    }
}

/**
 * @extends CanHandle&lt;OrderPlaced&gt;
 */
class UpdateInventory implements CanHandle
{
    public function __construct(
        private InventoryService $inventory
    ) {
        // Dependencies are injected automatically
    }

    public function handle(Event $event): void
    {
         $order = $event-&gt;getOrder();

         // Update inventory
         $this-&gt;inventory-&gt;reduceStock($order-&gt;getItems());
    }
}
</code></pre>
<h2>Best Practices</h2>
<ol>
<li><strong>Use Constructor Injection</strong>: Let PHPNomad's container manage your dependencies by declaring them in your
constructor:</li>
</ol>
<pre><code class="language-php">class WelcomeEmailListener implements CanHandle
{
    public function __construct(
        private EmailStrategy $emailService,
        private LoggerStrategy $logger
    ) {
    }

    public function handle(Event $event): void 
    {
        try {
            $this-&gt;emailService-&gt;send(
                [$event-&gt;getUser()-&gt;getEmail()],
                'Welcome!',
                'welcome-template',
                ['username' =&gt; $event-&gt;getUser()-&gt;getName()]
            );
        } catch (Exception $e) {
            $this-&gt;logger-&gt;error(&quot;Failed to send welcome email: &quot; . $e-&gt;getMessage());
        }
    }
}
</code></pre>
<ol start="2">
<li>
<p><strong>Keep Listeners Focused</strong>: Each listener should do one job well. If you find a listener doing too many things,
consider splitting it into multiple listeners.</p>
</li>
<li>
<p><strong>Use Interfaces</strong>: Always type-hint interfaces rather than concrete classes in your constructor. This keeps your
code flexible and testable.</p>
</li>
</ol>
<h2>Common Scenarios</h2>
<p>Here are some typical situations where event listeners are particularly useful:</p>
<ol>
<li><strong>User Actions</strong>:</li>
</ol>
<pre><code class="language-php">class UserProfileCreationListener implements CanHandle
{
    public function __construct(
        private ProfileService $profiles,
        private LoggerStrategy $logger
    ) {
    }

    public function handle(Event $event): void 
    {
        $this-&gt;profiles-&gt;createDefaultProfile($event-&gt;getUser());
    }
}
</code></pre>
<ol start="2">
<li><strong>Order Processing</strong>:</li>
</ol>
<pre><code class="language-php">class OrderPaymentListener implements CanHandle
{
    public function __construct(
        private PaymentService $payments,
        private LoggerStrategy $logger
    ) {
    }

    public function handle(Event $event): void 
    {
        $this-&gt;payments-&gt;processPayment($event-&gt;getOrder());
    }
}
</code></pre>
<h2>Troubleshooting</h2>
<p>If your listeners aren't working as expected, check these common issues:</p>
<ol>
<li>
<p><strong>Is the Event Being Triggered?</strong>
Make sure the event is actually being broadcast:</p>
<pre><code class="language-php">Event::broadcast(new UserRegistered($user));
</code></pre>
</li>
<li>
<p><strong>Is the Listener Registered?</strong>
Verify your listener is properly registered in your initializer.</p>
</li>
</ol>
<h2>Conclusion</h2>
<p>Event listeners in PHPNomad provide a clean, maintainable way to handle application events while taking full advantage
of dependency injection. By letting the container manage your dependencies, you create code that's not only easier to
maintain but also easier to test and modify. Each listener can focus on its specific task while having easy access to
any services it needs.</p>
<p>Think of event listeners as specialized workers in your application - each one has access to exactly the tools they
need (through dependency injection) and knows exactly what to do when certain events occur.</p>

    </main>
</div>

<footer>
    <p class="mod--center">These docs were built with <a href="https://www.github.com/phpnomad/documentation">a static site generator that was made with PHPNomad.</a></p>
<small class="mod--center">Made and maintained by the people at <a href="https://www.novatori.us">Novatorius</a>. <em>Mente Nova!</em></small></footer>
</body>
</html>

