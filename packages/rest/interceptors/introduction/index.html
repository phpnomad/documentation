<!DOCTYPE html>
<html>
<head>
    <title></title>
    <link rel="stylesheet" href="/public/assets/pico.min.css">
    <link rel="stylesheet" href="/public/assets/prism.css">
    <link rel="stylesheet" href="/public/assets/style.css">
    <script src="/public/assets/prism.js"></script>
</head>
<body>
<header>
    <nav>
    <a href="https://www.github.com/phpnomad">GitHub</a>
</nav></header>

<div class="docs-layout">
    <aside class="docs-sidebar">
                    <a href="/"><img src="/public/assets/logo.png" alt="PHPNomad Logo"/></a>
            <nav>
    
                                        <details class="nav-section" >
                    <summary>
                                                    Core concepts
                                            </summary>
                    <div class="nav-group">
                                                            <details class="nav-section" >
                    <summary>
                                                    Bootstrapping
                                            </summary>
                    <div class="nav-group">
                                                            <div class="nav-item">
                    <a href="/core-concepts/bootstrapping/advanced-bootstrapping" class="">
                        Advanced bootstrapping
                    </a>
                </div>
                                                <div class="nav-item">
                    <a href="/core-concepts/bootstrapping/creating-and-managing-initializers" class="">
                        Creating and managing initializers
                    </a>
                </div>
                                                <div class="nav-item">
                    <a href="/core-concepts/bootstrapping/introduction" class="">
                        Introduction
                    </a>
                </div>
                                                <div class="nav-item">
                    <a href="/core-concepts/bootstrapping/platform-integrations" class="">
                        Platform integrations
                    </a>
                </div>
                                                <details class="nav-section" >
                    <summary>
                                                    Initializers
                                            </summary>
                    <div class="nav-group">
                                                            <div class="nav-item">
                    <a href="/core-concepts/bootstrapping/initializers/event-binding" class="">
                        Event binding
                    </a>
                </div>
                                                <div class="nav-item">
                    <a href="/core-concepts/bootstrapping/initializers/event-listeners" class="">
                        Event listeners
                    </a>
                </div>
                                                <div class="nav-item">
                    <a href="/core-concepts/bootstrapping/initializers/facades" class="">
                        Facades
                    </a>
                </div>
                                                <div class="nav-item">
                    <a href="/core-concepts/bootstrapping/initializers/rest-controllers" class="">
                        Rest controllers
                    </a>
                </div>
                        
                    </div>
                </details>
                        
                    </div>
                </details>
                        
                    </div>
                </details>
                                                <details class="nav-section" open>
                    <summary>
                                                    Packages
                                            </summary>
                    <div class="nav-group">
                                                            <details class="nav-section" open>
                    <summary>
                                                    Rest
                                            </summary>
                    <div class="nav-group">
                                                            <div class="nav-item">
                    <a href="/packages/rest/controllers" class="">
                        Controllers
                    </a>
                </div>
                                                <div class="nav-item">
                    <a href="/packages/rest/integration-guide" class="">
                        Integration guide
                    </a>
                </div>
                                                <div class="nav-item">
                    <a href="/packages/rest/introduction" class="">
                        Introduction
                    </a>
                </div>
                                                <details class="nav-section" open>
                    <summary>
                                                    Interceptors
                                            </summary>
                    <div class="nav-group">
                                                            <div class="nav-item">
                    <a href="/packages/rest/interceptors/introduction" class="">
                        Introduction
                    </a>
                </div>
                                                <details class="nav-section" >
                    <summary>
                                                    Included interceptors
                                            </summary>
                    <div class="nav-group">
                                                            <div class="nav-item">
                    <a href="/packages/rest/interceptors/included-interceptors/event-interceptor" class="">
                        Event interceptor
                    </a>
                </div>
                        
                    </div>
                </details>
                        
                    </div>
                </details>
                                                <details class="nav-section" >
                    <summary>
                                                    Middleware
                                            </summary>
                    <div class="nav-group">
                                                            <div class="nav-item">
                    <a href="/packages/rest/middleware/introduction" class="">
                        Introduction
                    </a>
                </div>
                                                <details class="nav-section" >
                    <summary>
                                                    Included middleware
                                            </summary>
                    <div class="nav-group">
                                                            <div class="nav-item">
                    <a href="/packages/rest/middleware/included-middleware/callback-middleware" class="">
                        Callback middleware
                    </a>
                </div>
                                                <div class="nav-item">
                    <a href="/packages/rest/middleware/included-middleware/parse-jwt-middleware" class="">
                        Parse jwt middleware
                    </a>
                </div>
                                                <div class="nav-item">
                    <a href="/packages/rest/middleware/included-middleware/set-type-middleware" class="">
                        Set type middleware
                    </a>
                </div>
                                                <div class="nav-item">
                    <a href="/packages/rest/middleware/included-middleware/validation-middleware" class="">
                        Validation middleware
                    </a>
                </div>
                        
                    </div>
                </details>
                        
                    </div>
                </details>
                                                <details class="nav-section" >
                    <summary>
                                                    Validations
                                            </summary>
                    <div class="nav-group">
                                                            <div class="nav-item">
                    <a href="/packages/rest/validations/introduction" class="">
                        Introduction
                    </a>
                </div>
                                                <div class="nav-item">
                    <a href="/packages/rest/validations/validation-set" class="">
                        Validation set
                    </a>
                </div>
                                                <details class="nav-section" >
                    <summary>
                                                    Included validations
                                            </summary>
                    <div class="nav-group">
                                                            <div class="nav-item">
                    <a href="/packages/rest/validations/included-validations/is-any" class="">
                        Is any
                    </a>
                </div>
                                                <div class="nav-item">
                    <a href="/packages/rest/validations/included-validations/is-email" class="">
                        Is email
                    </a>
                </div>
                                                <div class="nav-item">
                    <a href="/packages/rest/validations/included-validations/is-greater-than" class="">
                        Is greater than
                    </a>
                </div>
                                                <div class="nav-item">
                    <a href="/packages/rest/validations/included-validations/is-numeric" class="">
                        Is numeric
                    </a>
                </div>
                                                <div class="nav-item">
                    <a href="/packages/rest/validations/included-validations/is-type" class="">
                        Is type
                    </a>
                </div>
                                                <div class="nav-item">
                    <a href="/packages/rest/validations/included-validations/keys-are-any" class="">
                        Keys are any
                    </a>
                </div>
                        
                    </div>
                </details>
                        
                    </div>
                </details>
                        
                    </div>
                </details>
                                                <details class="nav-section" >
                    <summary>
                                                    Utils
                                            </summary>
                    <div class="nav-group">
                                                            <div class="nav-item">
                    <a href="/packages/utils/array-helper" class="">
                        Array helper
                    </a>
                </div>
                                                <details class="nav-section" >
                    <summary>
                                                    Processors
                                            </summary>
                    <div class="nav-group">
                                                            <div class="nav-item">
                    <a href="/packages/utils/processors/array-processor" class="">
                        Array processor
                    </a>
                </div>
                                                <div class="nav-item">
                    <a href="/packages/utils/processors/list-filter" class="">
                        List filter
                    </a>
                </div>
                                                <div class="nav-item">
                    <a href="/packages/utils/processors/list-sorter" class="">
                        List sorter
                    </a>
                </div>
                        
                    </div>
                </details>
                        
                    </div>
                </details>
                        
                    </div>
                </details>
                        
</nav>            </aside>
    <main class="docs-content">
            <h1 id="interceptors">Interceptors</h1>
<p>Interceptors allow you to extend and customize the final stage of the request lifecycle in PHPNomad. They run after the
controller has returned its response but before that response is sent back to the client. This makes them ideal for
adapting outputs and handling cross-cutting concerns without bloating controller logic.</p>
<p>Unlike middleware, which runs before a controller executes, interceptors operate with full knowledge of the request and
response. This timing makes them uniquely suited for last-minute adjustments and side effects.</p>
<p>Interceptors give you the power to modify responses or trigger side effects at the very edge of the lifecycle. They see
the full picture—the request, the controller result, and the prepared response—allowing them to:</p>
<ul>
<li>Adapt responses into consistent formats</li>
<li>Enforce output policies centrally</li>
<li>Trigger events, logging, or metrics safely</li>
</ul>
<p>By keeping controllers lean and letting interceptors handle boundary concerns, your codebase remains portable,
maintainable, and easier to reason about.</p>
<h2 id="adapting-responses">Adapting Responses</h2>
<p>One common use case for interceptors is adapting a response into a format that is safe, portable, or consistent across
your API. Instead of forcing every controller to handle response shaping, you can offload that work to an interceptor
that runs at the boundary.</p>
<pre><code class="language-php">use PHPNomad\Rest\Interfaces\Interceptor;
use PHPNomad\Http\Interfaces\Request;
use PHPNomad\Http\Interfaces\Response;

final class ModelAdapterInterceptor implements Interceptor
{
    public function process(Request $request, Response $response): void
    {
        $body = $response-&gt;getBody();

        if (is_object($body) &amp;&amp; method_exists($body, 'toArray')) {
            $response-&gt;setJson($body-&gt;toArray());
        }
    }
}
</code></pre>
<p>This interceptor ensures that domain models are consistently converted into JSON arrays without controllers needing to
repeat that logic.</p>
<p><strong>Conclusion:</strong> By using interceptors for response adaptation, you centralize formatting rules and keep controllers
focused only on core business logic.</p>
<h2 id="handling-side-effects">Handling Side Effects</h2>
<p>Interceptors are also the right place for side effects that depend on the final result of a request. Since they execute
after the response has been prepared, they can safely trigger actions that should not interfere with the controller’s
outcome.</p>
<p>Typical examples include:</p>
<ul>
<li>Publishing domain events once a resource is created or updated</li>
<li>Logging details of completed requests</li>
<li>Recording metrics for observability</li>
</ul>
<pre><code class="language-php">&lt;?php

namespace App\Interceptors;

use PHPNomad\Rest\Interfaces\Interceptor;
use PHPNomad\Http\Interfaces\Request;
use PHPNomad\Http\Interfaces\Response;
use PHPNomad\Logger\Interfaces\LoggerStrategy;

final class LoggingInterceptor implements Interceptor
{
    public function __construct(private LoggerStrategy $logger) {}

    public function process(Request $request, Response $response): void
    {
        $this-&gt;logger-&gt;info('API Request Completed', [
            'path'   =&gt; $request-&gt;getPath(),
            'method' =&gt; $request-&gt;getMethod(),
            'status' =&gt; $response-&gt;getStatus(),
        ]);
    }
}
</code></pre>
<p>This interceptor adds to the logger after a request succeeds, without polluting controller code.</p>
<p>By isolating side effects inside interceptors, you keep your controllers deterministic and ensure cross-cutting actions
happen reliably at the right time.</p>
<h3 id="ordering-and-execution">Ordering and Execution</h3>
<p>When you define multiple interceptors for a controller, their order matters. They execute sequentially, and later
interceptors see the modifications made by earlier ones.</p>
<p>This allows you to stack concerns: for example, one interceptor could adapt models into arrays, and another could wrap
all responses into a common envelope.</p>
<ul>
<li>Interceptors run in the order returned from <code>getInterceptors()</code>.</li>
<li>Each interceptor receives the final <code>Request</code> and <code>Response</code>.</li>
<li>They may mutate the response body, headers, or status.</li>
</ul>
<p>By controlling interceptor ordering, you can compose response pipelines cleanly without entangling unrelated concerns.</p>
<h3 id="best-practices">Best Practices</h3>
<p>Interceptors are powerful, but like middleware, they work best when kept focused and predictable.</p>
<p>Because they can mutate responses or trigger external systems, it’s important to apply consistent patterns to avoid
confusion and unintended side effects.</p>
<ul>
<li>Keep interceptors <strong>single-purpose</strong> (e.g., one for adaptation, one for events).</li>
<li><strong>Don’t hide failures</strong>: catch exceptions from side effects, but log them for observability.</li>
<li>Use interceptors to <strong>enforce cross-cutting policies</strong> (envelopes, headers, serialization), not domain logic.</li>
<li>Be explicit about <strong>which interceptors run where</strong>—avoid magical or hidden behaviors.</li>
</ul>
<p>Following these practices ensures interceptors stay predictable, reusable, and maintainable over time.</p>

    </main>
</div>

<footer>
    <p class="mod--center">These docs were built with <a href="https://www.github.com/phpnomad/documentation">a static site generator that was made with PHPNomad.</a></p>
<small class="mod--center">Made and maintained by the people at <a href="https://www.novatori.us">Novatorius</a>. <em>Mente Nova!</em></small></footer>
</body>
</html>

