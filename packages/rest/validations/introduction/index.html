<!DOCTYPE html>
<html>
<head>
    <title></title>
    <link rel="stylesheet" href="/public/assets/pico.min.css">
    <link rel="stylesheet" href="/public/assets/prism.css">
    <link rel="stylesheet" href="/public/assets/style.css">
    <script src="/public/assets/prism.js"></script>
</head>
<body>
<header>
    <nav>
    <a href="https://www.github.com/phpnomad">GitHub</a>
</nav></header>

<div class="docs-layout">
    <aside class="docs-sidebar">
                    <a href="/"><img src="/public/assets/logo.png" alt="PHPNomad Logo"/></a>
            <nav>
    
                                        <details class="nav-section" >
                    <summary>
                                                    Core concepts
                                            </summary>
                    <div class="nav-group">
                                                            <details class="nav-section" >
                    <summary>
                                                    Bootstrapping
                                            </summary>
                    <div class="nav-group">
                                                            <div class="nav-item">
                    <a href="/core-concepts/bootstrapping/advanced-bootstrapping" class="">
                        Advanced bootstrapping
                    </a>
                </div>
                                                <div class="nav-item">
                    <a href="/core-concepts/bootstrapping/creating-and-managing-initializers" class="">
                        Creating and managing initializers
                    </a>
                </div>
                                                <div class="nav-item">
                    <a href="/core-concepts/bootstrapping/introduction" class="">
                        Introduction
                    </a>
                </div>
                                                <div class="nav-item">
                    <a href="/core-concepts/bootstrapping/platform-integrations" class="">
                        Platform integrations
                    </a>
                </div>
                                                <details class="nav-section" >
                    <summary>
                                                    Initializers
                                            </summary>
                    <div class="nav-group">
                                                            <div class="nav-item">
                    <a href="/core-concepts/bootstrapping/initializers/event-binding" class="">
                        Event binding
                    </a>
                </div>
                                                <div class="nav-item">
                    <a href="/core-concepts/bootstrapping/initializers/event-listeners" class="">
                        Event listeners
                    </a>
                </div>
                                                <div class="nav-item">
                    <a href="/core-concepts/bootstrapping/initializers/facades" class="">
                        Facades
                    </a>
                </div>
                                                <div class="nav-item">
                    <a href="/core-concepts/bootstrapping/initializers/rest-controllers" class="">
                        Rest controllers
                    </a>
                </div>
                        
                    </div>
                </details>
                        
                    </div>
                </details>
                        
                    </div>
                </details>
                                                <details class="nav-section" open>
                    <summary>
                                                    Packages
                                            </summary>
                    <div class="nav-group">
                                                            <details class="nav-section" open>
                    <summary>
                                                    Rest
                                            </summary>
                    <div class="nav-group">
                                                            <div class="nav-item">
                    <a href="/packages/rest/controllers" class="">
                        Controllers
                    </a>
                </div>
                                                <div class="nav-item">
                    <a href="/packages/rest/integration-guide" class="">
                        Integration guide
                    </a>
                </div>
                                                <div class="nav-item">
                    <a href="/packages/rest/introduction" class="">
                        Introduction
                    </a>
                </div>
                                                <details class="nav-section" >
                    <summary>
                                                    Interceptors
                                            </summary>
                    <div class="nav-group">
                                                            <div class="nav-item">
                    <a href="/packages/rest/interceptors/introduction" class="">
                        Introduction
                    </a>
                </div>
                                                <details class="nav-section" >
                    <summary>
                                                    Included interceptors
                                            </summary>
                    <div class="nav-group">
                                                            <div class="nav-item">
                    <a href="/packages/rest/interceptors/included-interceptors/event-interceptor" class="">
                        Event interceptor
                    </a>
                </div>
                        
                    </div>
                </details>
                        
                    </div>
                </details>
                                                <details class="nav-section" >
                    <summary>
                                                    Middleware
                                            </summary>
                    <div class="nav-group">
                                                            <div class="nav-item">
                    <a href="/packages/rest/middleware/introduction" class="">
                        Introduction
                    </a>
                </div>
                                                <details class="nav-section" >
                    <summary>
                                                    Included middleware
                                            </summary>
                    <div class="nav-group">
                                                            <div class="nav-item">
                    <a href="/packages/rest/middleware/included-middleware/callback-middleware" class="">
                        Callback middleware
                    </a>
                </div>
                                                <div class="nav-item">
                    <a href="/packages/rest/middleware/included-middleware/parse-jwt-middleware" class="">
                        Parse jwt middleware
                    </a>
                </div>
                                                <div class="nav-item">
                    <a href="/packages/rest/middleware/included-middleware/set-type-middleware" class="">
                        Set type middleware
                    </a>
                </div>
                                                <div class="nav-item">
                    <a href="/packages/rest/middleware/included-middleware/validation-middleware" class="">
                        Validation middleware
                    </a>
                </div>
                        
                    </div>
                </details>
                        
                    </div>
                </details>
                                                <details class="nav-section" open>
                    <summary>
                                                    Validations
                                            </summary>
                    <div class="nav-group">
                                                            <div class="nav-item">
                    <a href="/packages/rest/validations/introduction" class="">
                        Introduction
                    </a>
                </div>
                                                <div class="nav-item">
                    <a href="/packages/rest/validations/validation-set" class="">
                        Validation set
                    </a>
                </div>
                                                <details class="nav-section" >
                    <summary>
                                                    Included validations
                                            </summary>
                    <div class="nav-group">
                                                            <div class="nav-item">
                    <a href="/packages/rest/validations/included-validations/is-any" class="">
                        Is any
                    </a>
                </div>
                                                <div class="nav-item">
                    <a href="/packages/rest/validations/included-validations/is-email" class="">
                        Is email
                    </a>
                </div>
                                                <div class="nav-item">
                    <a href="/packages/rest/validations/included-validations/is-greater-than" class="">
                        Is greater than
                    </a>
                </div>
                                                <div class="nav-item">
                    <a href="/packages/rest/validations/included-validations/is-numeric" class="">
                        Is numeric
                    </a>
                </div>
                                                <div class="nav-item">
                    <a href="/packages/rest/validations/included-validations/is-type" class="">
                        Is type
                    </a>
                </div>
                                                <div class="nav-item">
                    <a href="/packages/rest/validations/included-validations/keys-are-any" class="">
                        Keys are any
                    </a>
                </div>
                        
                    </div>
                </details>
                        
                    </div>
                </details>
                        
                    </div>
                </details>
                                                <details class="nav-section" >
                    <summary>
                                                    Utils
                                            </summary>
                    <div class="nav-group">
                                                            <div class="nav-item">
                    <a href="/packages/utils/array-helper" class="">
                        Array helper
                    </a>
                </div>
                                                <details class="nav-section" >
                    <summary>
                                                    Processors
                                            </summary>
                    <div class="nav-group">
                                                            <div class="nav-item">
                    <a href="/packages/utils/processors/array-processor" class="">
                        Array processor
                    </a>
                </div>
                                                <div class="nav-item">
                    <a href="/packages/utils/processors/list-filter" class="">
                        List filter
                    </a>
                </div>
                                                <div class="nav-item">
                    <a href="/packages/utils/processors/list-sorter" class="">
                        List sorter
                    </a>
                </div>
                        
                    </div>
                </details>
                        
                    </div>
                </details>
                        
                    </div>
                </details>
                        
</nav>            </aside>
    <main class="docs-content">
            <h1 id="validations">Validations</h1>
<p>Validations in PHPNomad are designed to make <strong>input expectations explicit and declarative</strong>. Instead of scattering
checks throughout your controller code, you can attach a set of rules that describe what makes a request valid. This
makes endpoints easier to reason about and more portable across different contexts.</p>
<h2 id="declarative-by-design">Declarative by Design</h2>
<p>A validation is a small class that implements the <code>Validation</code> interface. It defines three things:</p>
<ul>
<li><strong>What to check</strong> — via <code>isValid()</code>, given the current request.</li>
<li><strong>What message to return</strong> — via <code>getErrorMessage()</code>.</li>
<li><strong>How to describe the failure</strong> — via <code>getType()</code> and <code>getContext()</code> for machine-readable error handling.</li>
</ul>
<p>This means you can build reusable validation rules like “IDs must exist,” “this field must be unique,” or “value must
match a regex,” and apply them consistently wherever needed.</p>
<h2 id="how-validations-run">How Validations Run</h2>
<p>You don’t call validations directly. Instead, PHPNomad provides the <code>ValidationMiddleware</code>, a built-in middleware that
automatically runs the validations you’ve declared for a controller or another provider.</p>
<p>This middleware iterates over each field’s <a href="/packages/rest/validations/validation-set">Validation Set</a>, checking if the field is required and
applying each validation rule in turn.</p>
<p>If any rules fail, the middleware throws a <code>ValidationException</code>, and the system generates a structured error response.
This keeps controllers focused on business logic, while still ensuring strong input guarantees.</p>
<h2 id="why-it-matters">Why It Matters</h2>
<p>By keeping validations declarative:</p>
<ul>
<li><strong>Controllers stay clean</strong> — no inline <code>if</code> checks scattered around.</li>
<li><strong>Errors are consistent</strong> — all validation failures return the same error format.</li>
<li><strong>Rules are reusable</strong> — you can apply the same validation logic across multiple endpoints.</li>
</ul>
<h2 id="example-custom-validation-with-a-datastore">Example: Custom Validation with a Datastore</h2>
<p>Suppose you want to ensure that a record <strong>does not already exist</strong> before creating it. For example, you might prevent
creating a user with an <code>id</code> that’s already taken. You can implement this as a reusable validation that queries a
datastore.</p>
<pre><code class="language-php">&lt;?php

namespace App\Validations;

use PHPNomad\Rest\Interfaces\Validation;
use PHPNomad\Http\Interfaces\Request;
use PHPNomad\Datastore\Exceptions\RecordNotFound;
use PHPNomad\Datastore\Interfaces\Datastore;

final class DoesNotExist implements Validation
{
    public function __construct(private Datastore $datastore) {}

    public function isValid(string $key, Request $request): bool
    {
        $id = $request-&gt;getParam($key);

        try {
            $this-&gt;datastore-&gt;find($id);
            // If a record is found, this is a failure.
            return false;
        } catch (RecordNotFound $e) {
            // Not found means it’s valid.
            return true;
        }
    }

    public function getErrorMessage(): string
    {
        return 'A record with this identifier already exists.';
    }

    public function getType(): string
    {
        return 'record_exists';
    }

    public function getContext(string $key, Request $request): array
    {
        return [
            'field' =&gt; $key,
            'value' =&gt; $request-&gt;getParam($key),
        ];
    }
}
</code></pre>
<p>This validation:</p>
<ul>
<li>Looks up the parameter value in a datastore.</li>
<li>If the record exists, the validation fails.</li>
<li>If the datastore throws <code>RecordNotFound</code>, the validation passes.</li>
<li>Produces a structured error message and type when it fails.</li>
</ul>
<hr />
<h2 id="attaching-the-validation">Attaching the Validation</h2>
<p>Here’s how a controller might use it when creating a new record:</p>
<pre><code class="language-php">&lt;?php

use PHPNomad\Http\Enums\Method;
use PHPNomad\Http\Interfaces\Request;
use PHPNomad\Http\Interfaces\Response;
use PHPNomad\Rest\Interfaces\Controller;
use PHPNomad\Rest\Interfaces\HasValidations;
use PHPNomad\Rest\Interfaces\HasMiddleware;
use PHPNomad\Rest\Factories\ValidationSet;
use PHPNomad\Rest\Middleware\ValidationMiddleware;
use App\Validations\DoesNotExist;
use PHPNomad\Datastore\Interfaces\Datastore;

final class CreateUser implements Controller, HasValidations, HasMiddleware
{
    public function __construct(
        private Response $response,
        private Datastore $users
    ) {}

    public function getEndpoint(): string { return '/users'; }
    public function getMethod(): string   { return Method::Post; }

    public function getResponse(Request $request): Response
    {
        // At this point, we know &quot;id&quot; does not already exist.
        $id = $request-&gt;getParam('id');

        $this-&gt;users-&gt;create(['id' =&gt; $id]);

        return $this-&gt;response
            -&gt;setStatus(201)
            -&gt;setJson(['id' =&gt; $id, 'status' =&gt; 'created']);
    }

    public function getValidations(): array
    {
        return [
            'id' =&gt; (new ValidationSet())
                -&gt;setRequired()
                -&gt;addValidation(fn() =&gt; new DoesNotExist($this-&gt;users)),
        ];
    }

    public function getMiddleware(Request $request): array
    {
        return [ new ValidationMiddleware($this) ];
    }
}
</code></pre>
<hr />
<h3 id="example-request">Example request</h3>
<pre><code>POST /users
Content-Type: application/json

{
  &quot;id&quot;: &quot;abc123&quot;
}
</code></pre>
<h3 id="example-error-response-if-a-record-with-idabc123-already-exists">Example error response (if a record with <code>id=abc123</code> already exists)</h3>
<pre><code class="language-json">{
  &quot;error&quot;: {
    &quot;message&quot;: &quot;Validations failed.&quot;,
    &quot;context&quot;: {
      &quot;id&quot;: [
        &quot;A record with this identifier already exists.&quot;
      ]
    }
  }
}
</code></pre>

    </main>
</div>

<footer>
    <p class="mod--center">These docs were built with <a href="https://www.github.com/phpnomad/documentation">a static site generator that was made with PHPNomad.</a></p>
<small class="mod--center">Made and maintained by the people at <a href="https://www.novatori.us">Novatorius</a>. <em>Mente Nova!</em></small></footer>
</body>
</html>

