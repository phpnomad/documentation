<!DOCTYPE html>
<html>
<head>
    <title></title>
    <link rel="stylesheet" href="/public/assets/pico.min.css">
    <link rel="stylesheet" href="/public/assets/prism.css">
    <link rel="stylesheet" href="/public/assets/style.css">
    <script src="/public/assets/prism.js"></script>
</head>
<body>
<header>
    <nav>
    <a href="https://www.github.com/phpnomad">GitHub</a>
</nav></header>

<div class="docs-layout">
    <aside class="docs-sidebar">
                    <a href="/"><img src="/public/assets/logo.png" alt="PHPNomad Logo"/></a>
            <nav>
    
                                        <details class="nav-section" >
                    <summary>
                                                    Core concepts
                                            </summary>
                    <div class="nav-group">
                                                            <details class="nav-section" >
                    <summary>
                                                    Bootstrapping
                                            </summary>
                    <div class="nav-group">
                                                            <div class="nav-item">
                    <a href="/core-concepts/bootstrapping/advanced-bootstrapping" class="">
                        Advanced bootstrapping
                    </a>
                </div>
                                                <div class="nav-item">
                    <a href="/core-concepts/bootstrapping/creating-and-managing-initializers" class="">
                        Creating and managing initializers
                    </a>
                </div>
                                                <details class="nav-section" >
                    <summary>
                                                    Initializers
                                            </summary>
                    <div class="nav-group">
                                                            <div class="nav-item">
                    <a href="/core-concepts/bootstrapping/initializers/event-binding" class="">
                        Event binding
                    </a>
                </div>
                                                <div class="nav-item">
                    <a href="/core-concepts/bootstrapping/initializers/event-listeners" class="">
                        Event listeners
                    </a>
                </div>
                                                <div class="nav-item">
                    <a href="/core-concepts/bootstrapping/initializers/facades" class="">
                        Facades
                    </a>
                </div>
                                                <div class="nav-item">
                    <a href="/core-concepts/bootstrapping/initializers/rest-controllers" class="">
                        Rest controllers
                    </a>
                </div>
                        
                    </div>
                </details>
                                                <div class="nav-item">
                    <a href="/core-concepts/bootstrapping/introduction" class="">
                        Introduction
                    </a>
                </div>
                                                <div class="nav-item">
                    <a href="/core-concepts/bootstrapping/platform-integrations" class="">
                        Platform integrations
                    </a>
                </div>
                        
                    </div>
                </details>
                        
                    </div>
                </details>
                                                <details class="nav-section" open>
                    <summary>
                                                    Packages
                                            </summary>
                    <div class="nav-group">
                                                            <details class="nav-section" open>
                    <summary>
                                                    Rest
                                            </summary>
                    <div class="nav-group">
                                                            <div class="nav-item">
                    <a href="/packages/rest/controllers" class="">
                        Controllers
                    </a>
                </div>
                                                <div class="nav-item">
                    <a href="/packages/rest/integration-guide" class="">
                        Integration guide
                    </a>
                </div>
                                                <details class="nav-section" >
                    <summary>
                                                    Interceptors
                                            </summary>
                    <div class="nav-group">
                                                            <details class="nav-section" >
                    <summary>
                                                    Included interceptors
                                            </summary>
                    <div class="nav-group">
                                                            <div class="nav-item">
                    <a href="/packages/rest/interceptors/included-interceptors/event-interceptor" class="">
                        Event interceptor
                    </a>
                </div>
                        
                    </div>
                </details>
                                                <div class="nav-item">
                    <a href="/packages/rest/interceptors/introduction" class="">
                        Introduction
                    </a>
                </div>
                        
                    </div>
                </details>
                                                <div class="nav-item">
                    <a href="/packages/rest/introduction" class="">
                        Introduction
                    </a>
                </div>
                                                <details class="nav-section" >
                    <summary>
                                                    Middleware
                                            </summary>
                    <div class="nav-group">
                                                            <details class="nav-section" >
                    <summary>
                                                    Included middleware
                                            </summary>
                    <div class="nav-group">
                                                            <div class="nav-item">
                    <a href="/packages/rest/middleware/included-middleware/callback-middleware" class="">
                        Callback middleware
                    </a>
                </div>
                                                <div class="nav-item">
                    <a href="/packages/rest/middleware/included-middleware/parse-jwt-middleware" class="">
                        Parse jwt middleware
                    </a>
                </div>
                                                <div class="nav-item">
                    <a href="/packages/rest/middleware/included-middleware/set-type-middleware" class="">
                        Set type middleware
                    </a>
                </div>
                                                <div class="nav-item">
                    <a href="/packages/rest/middleware/included-middleware/validation-middleware" class="">
                        Validation middleware
                    </a>
                </div>
                        
                    </div>
                </details>
                                                <div class="nav-item">
                    <a href="/packages/rest/middleware/introduction" class="">
                        Introduction
                    </a>
                </div>
                        
                    </div>
                </details>
                                                <details class="nav-section" >
                    <summary>
                                                    Validations
                                            </summary>
                    <div class="nav-group">
                                                            <details class="nav-section" >
                    <summary>
                                                    Included validations
                                            </summary>
                    <div class="nav-group">
                                                            <div class="nav-item">
                    <a href="/packages/rest/validations/included-validations/is-any" class="">
                        Is any
                    </a>
                </div>
                                                <div class="nav-item">
                    <a href="/packages/rest/validations/included-validations/is-email" class="">
                        Is email
                    </a>
                </div>
                                                <div class="nav-item">
                    <a href="/packages/rest/validations/included-validations/is-greater-than" class="">
                        Is greater than
                    </a>
                </div>
                                                <div class="nav-item">
                    <a href="/packages/rest/validations/included-validations/is-numeric" class="">
                        Is numeric
                    </a>
                </div>
                                                <div class="nav-item">
                    <a href="/packages/rest/validations/included-validations/is-type" class="">
                        Is type
                    </a>
                </div>
                                                <div class="nav-item">
                    <a href="/packages/rest/validations/included-validations/keys-are-any" class="">
                        Keys are any
                    </a>
                </div>
                        
                    </div>
                </details>
                                                <div class="nav-item">
                    <a href="/packages/rest/validations/introduction" class="">
                        Introduction
                    </a>
                </div>
                                                <div class="nav-item">
                    <a href="/packages/rest/validations/validation-set" class="">
                        Validation set
                    </a>
                </div>
                        
                    </div>
                </details>
                        
                    </div>
                </details>
                                                <details class="nav-section" >
                    <summary>
                                                    Utils
                                            </summary>
                    <div class="nav-group">
                                                            <div class="nav-item">
                    <a href="/packages/utils/array-helper" class="">
                        Array helper
                    </a>
                </div>
                                                <details class="nav-section" >
                    <summary>
                                                    Processors
                                            </summary>
                    <div class="nav-group">
                                                            <div class="nav-item">
                    <a href="/packages/utils/processors/array-processor" class="">
                        Array processor
                    </a>
                </div>
                                                <div class="nav-item">
                    <a href="/packages/utils/processors/list-filter" class="">
                        List filter
                    </a>
                </div>
                                                <div class="nav-item">
                    <a href="/packages/utils/processors/list-sorter" class="">
                        List sorter
                    </a>
                </div>
                        
                    </div>
                </details>
                        
                    </div>
                </details>
                        
                    </div>
                </details>
                        
</nav>            </aside>
    <main class="docs-content">
            <h1 id="rest-platform-integration-guide">REST Platform Integration Guide</h1>
<p>This guide is for engineers wiring PHPNomad controllers into a specific PHP platform with an HTTP runtime. If you’ve
never extended PHPNomad before, start here.</p>
<p>By the end, you’ll have a thin adapter that lets controllers run unchanged on your platform. It will register
controllers with your router, translate your platform’s request into PHPNomad’s <code>Request</code>, convert controller <code>Response</code>
objects back into your platform’s response, and keep error handling consistent.</p>
<p>You are responsible for a small contract:</p>
<ul>
<li>RestStrategy implementation - to map a controller’s <code>(method, endpoint)</code> into your router and drive the request
lifecycle.</li>
<li>Request implementation - to expose method, path, headers, params, body, and a safe attribute bag without leaking
platform
types.</li>
<li>Response implementation - to set status, headers, and body while leaving serialization to the strategy.
<em>(Authentication can be added via middleware, but it’s optional.)</em></li>
</ul>
<p>This is in great shape—clear, concrete, and the two integration styles (platform-led vs strategy-led) come through
nicely. What’s still missing or underspecified are a few “contract” rules that first-time extenders won’t intuit:</p>
<ul>
<li>the lifecycle contract (stated explicitly, not just implied),</li>
<li>the portable endpoint schema and how params get injected,</li>
<li>deterministic param resolution (route → query → body),</li>
<li>the error-mapping guarantee and envelope shape,</li>
<li>who serializes responses (strategy vs adapter) and body-parsing rules,</li>
<li>what “Auth via middleware” means when the platform already has permission hooks.</li>
</ul>
<p>Below are short, drop-in blocks you can add to the intro section (kept skimmable, with bullets only where they carry
weight).</p>
<h2 id="integration-contract">Integration contract</h2>
<p>To integrate with PHPNomad, your adapter must follow these rules.</p>
<h3 id="lifecycle-required-order">Lifecycle (required order)</h3>
<p>The request must flow in this order. Don’t skip or reorder steps.</p>
<pre><code>Route → Middleware → Controller → Response → Interceptors
</code></pre>
<h3 id="endpoint-schema-portable">Endpoint schema (portable)</h3>
<p>Controllers declare endpoints like <code>/widgets/{id}</code> using only literals and named params. Your adapter translates to the
platform’s DSL <strong>and</strong> injects captured values back into <code>Request</code> under the same keys.</p>
<ul>
<li>Example: <code>/widgets/{id}</code> → WordPress <code>(?P&lt;id&gt;[\d]+)</code> or FastRoute <code>{id:\w+}</code></li>
<li>Inside controllers, <code>$request-&gt;getParam('id')</code> works the same on every platform.</li>
</ul>
<h2 id="examples">Examples</h2>
<p>See these existing adapters for reference implementations.</p>
<ul>
<li><a href="https://github.com/phpnomad/fastroute-integration">FastRoute Integration</a></li>
<li><a href="https://github.com/phpnomad/wordpress-integration">WordPress Integration</a></li>
</ul>
<h2 id="approach">Approach</h2>
<p>The key to setting up PHPNomad's REST implementation with a platform is that you have to implement the Request,
Response, and RestStrategy, and usually Auth as well.</p>
<p>These are all baked into existing platforms, so usually implementing these feels more like adapting the existing
platform into PHPNomad's syntax.</p>
<p>For example in
the <a href="https://github.com/phpnomad/wordpress-integration/blob/main/lib/Strategies/RestStrategy.php">WordPress integration's RestStrategy</a>,
it registers the route like this:</p>
<pre><code class="language-php">public function registerRoute(callable $controllerGetter)
{
    // Register the route with WordPress.
    add_action('rest_api_init', function () use ($controllerGetter) {
        /** @var Controller $controller */
        $controller = $controllerGetter();
        // Use WordPress's register_rest_route function to register the route.
        register_rest_route(
            $this-&gt;restNamespaceProvider-&gt;getRestNamespace(),
            $this-&gt;convertEndpointFormat($controller-&gt;getEndpoint()),
            [
                'methods' =&gt; $controller-&gt;getMethod(),
                'callback' =&gt; fn(WP_REST_Request $request) =&gt; $this-&gt;handleRequest($controller, new WordPressRequest($request, $this-&gt;currentUserResolver-&gt;getCurrentUser())),
                'permission_callback' =&gt; '__return_true'
            ]
        );
    });
}
</code></pre>
<p>The <code>handleRequest</code> method that actually does the work of adapting the PHPNomad request into a WordPress request.
It does this by passing
a <a href="https://github.com/phpnomad/wordpress-integration/blob/main/lib/Rest/Request.php">WordPressRequest</a> object, which
implements PHPNomad's <code>Request</code> interface. <code>handleRequest</code> then runs the controller and converts the response back
into a WordPress response.</p>
<p><a href="https://github.com/phpnomad/wordpress-integration/blob/main/lib/Strategies/RestStrategy.php#L77-L102">You can see it in action here.</a>,
but the guts of it are in this method, which runs middleware, gets the response, and runs interceptors:</p>
<pre><code class="language-php">private function wrapCallback(Controller $controller, Request $request): Response
{
    // Maybe process middleware.
    if ($controller instanceof HasMiddleware) {
        Arr::each($controller-&gt;getMiddleware($request), fn(Middleware $middleware) =&gt; $middleware-&gt;process($request));
    }


    /** @var \PHPNomad\Integrations\WordPress\Rest\Response $response */
    $response = $controller-&gt;getResponse($request);


    // Maybe process interceptors.
    if ($controller instanceof HasInterceptors) {
        Arr::each($controller-&gt;getInterceptors($request, $response), fn(Interceptor $interceptor) =&gt; $interceptor-&gt;process($request, $response));
    }


    return $response;
}
</code></pre>
<p>In some cases, the integration is more-loosely built. For example, the fastroute integration specifically targets
making fastroute natively use PHPNomad to handle building a minimalistic REST API that uses PHPNomad.</p>
<p>This requires a bit more code to accomplish, since Fastroute doesn't handle a lot of the necessary aspects for us. In
the case of Fastroute, we created our own registry to store the routes so that we can reference that and handle routing
ourselves. As shown above, other platforms like WordPress or Laravel would handle most of this for us.</p>
<p>Fastroute's <code>registerRoute</code> method looks like this:</p>
<pre><code class="language-php">public function registerRoute(callable $controllerGetter)
{
    $this-&gt;registry-&gt;set(function () use ($controllerGetter) {
        /** @var Controller $controller */
        $controller = $controllerGetter();


        return [
          $controller-&gt;getMethod(),
          $controller-&gt;getEndpoint(),
          function ($request) use ($controller) {
              if ($controller instanceof HasMiddleware) {
                  $this-&gt;runMiddleware($controller, $request);
              }
              $response = $controller-&gt;getResponse($request);
              $this-&gt;setRestHeaders($response);


              if ($controller instanceof HasInterceptors) {
                  $this-&gt;runInterceptors($controller, $request, $response);
              }


              return $response;
          }
        ];


    });
}
</code></pre>
<p>The main difference here is that we needed to provide our own routing registry, and we also needed to handle
setting the response headers, since Fastroute doesn't do that for us, however the rest of the logic is very similar to
the WordPress example above.</p>
<ul>
<li>Run middleware if the controller has any.</li>
<li>Get the response from the controller.</li>
<li>Set the response headers.</li>
<li>Run interceptors if the controller has any.</li>
<li>Return the response.</li>
</ul>

    </main>
</div>

<footer>
    <p class="mod--center">These docs were built with <a href="https://www.github.com/phpnomad/documentation">a static site generator that was made with PHPNomad.</a></p>
<small class="mod--center">Made and maintained by the people at <a href="https://www.novatori.us">Novatorius</a>. <em>Mente Nova!</em></small></footer>
</body>
</html>

